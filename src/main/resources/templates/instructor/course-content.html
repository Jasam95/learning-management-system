<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="${course.title} + ' - Content'">Course Content</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div th:replace="~{fragments/navbar :: navbar}"></div>

<!-- Use layout with content -->
<div th:replace="~{fragments/sidebar :: layout(~{::content})}">
  <div th:fragment="content">
      <a th:href="@{/instructor/courses}" class="btn btn-secondary mb-3">Back to Courses</a>

      <h3 th:text="${course.title}">Course Title</h3>

      <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

      <hr/>

      <h5>Upload New Content</h5>
      <form th:action="@{'/instructor/course/' + ${course.id} + '/upload'}" method="post" enctype="multipart/form-data">
        <div class="mb-2">
          <label class="form-label">Title (optional)</label>
          <input type="text" name="title" class="form-control" />
        </div>

        <div class="mb-2">
          <label class="form-label">Content Type</label>
          <select name="contentType" class="form-select" required>
            <option th:each="ct : ${contentTypes}" th:value="${ct}" th:text="${ct}"></option>
          </select>
        </div>

        <div class="mb-2">
          <label class="form-label">File</label>
          <input type="file" name="file" class="form-control" required />
        </div>

        <button class="btn btn-success" type="submit">Upload</button>
      </form>

      <hr/>

      <h5 class="mt-4">Existing Content</h5>
      <table class="table table-striped mt-2">
        <thead>
        <tr>
          <th>Title</th>
          <th>Type</th>
          <th>Uploaded At</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="c : ${contents}">
          <td th:text="${c.title}"></td>
          <td th:text="${c.contentType}"></td>
          <td th:text="${c.uploadedAt != null ? #temporals.format(c.uploadedAt, 'yyyy-MM-dd HH:mm') : 'N/A'}"></td>


          <td>
            <a th:href="@{${c.contentUrl}}" class="btn btn-sm btn-info" target="_blank">Open</a>
            <a class="btn btn-sm btn-danger"
               th:href="@{'/instructor/course/' + ${course.id} + '/content/delete/' + ${c.id}}"
               onclick="return confirm('Delete content?')">Delete</a>
          </td>
        </tr>
        <tr th:if="${contents.size() == 0}">
          <td colspan="4">No content uploaded yet.</td>
        </tr>
        </tbody>
      </table>
  </div>
</div>
</body>
</html>
